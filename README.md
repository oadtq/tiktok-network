## Quick Start

> **Note**
> The [db](./packages/db) package is preconfigured to use Supabase and is **edge-bound** with the [Vercel Postgres](https://github.com/vercel/storage/tree/main/packages/postgres) driver. If you're using something else, make the necessary modifications to the [schema](./packages/db/src/schema.ts) as well as the [client](./packages/db/src/index.ts) and the [drizzle config](./packages/db/drizzle.config.ts). If you want to switch to non-edge database driver, remove `export const runtime = "edge";` [from all pages and api routes](https://github.com/t3-oss/create-t3-turbo/issues/634#issuecomment-1730240214).

To get it running, follow the steps below:

### 1. Setup dependencies

> [!NOTE]
>
> While the repo does contain both a Next.js and Tanstack Start version of a web app, you can pick which one you like to use and delete the other folder before starting the setup.

```bash
# Install dependencies
pnpm i

# Configure environment variables
# There is an `.env.example` in the root directory you can use for reference
cp .env.example .env

# Push the Drizzle schema to the database
pnpm db:push
```

### 2a. When it's time to add a new UI component

Run the `ui-add` script to add a new UI component using the interactive `shadcn/ui` CLI:

```bash
pnpm ui-add
```

When the component(s) has been installed, you should be good to go and start using it in your app.

### 2b. When it's time to add a new package

To add a new package, simply run `pnpm turbo gen init` in the monorepo root. This will prompt you for a package name as well as if you want to install any dependencies to the new package (of course you can also do this yourself later).

The generator sets up the `package.json`, `tsconfig.json` and a `index.ts`, as well as configures all the necessary configurations for tooling around your package such as formatting, linting and typechecking. When the package is created, you're ready to go build out the package.

## FAQ

### Does this pattern leak backend code to my client applications?

No, it does not. The `api` package should only be a production dependency in the Next.js application where it's served. The Expo app, and all other apps you may add in the future, should only add the `api` package as a dev dependency. This lets you have full typesafety in your client applications, while keeping your backend code safe.

If you need to share runtime code between the client and server, such as input validation schemas, you can create a separate `shared` package for this and import it on both sides.

## Deployment

### Next.js

#### Deploy to Vercel

Let's deploy the Next.js application to [Vercel](https://vercel.com). If you've never deployed a Turborepo app there, don't worry, the steps are quite straightforward. You can also read the [official Turborepo guide](https://vercel.com/docs/concepts/monorepos/turborepo) on deploying to Vercel.

1. Create a new project on Vercel, select the `apps/nextjs` folder as the root directory. Vercel's zero-config system should handle all configurations for you.

2. Add your `POSTGRES_URL` environment variable.

3. Done! Your app should successfully deploy. Assign your domain and use that instead of `localhost` for the `url` in the Expo app so that your Expo app can communicate with your backend when you are not in development.

### Auth Proxy

The auth proxy comes as a better-auth plugin. This is required for the Next.js app to be able to authenticate users in preview deployments. The auth proxy is not used for OAuth request in production deployments. The easiest way to get it running is to deploy the Next.js app to vercel.

## Testing TikTok OAuth

To test the TikTok OAuth integration locally, you must use a public HTTPS URL because TikTok's Developer Portal does not support `localhost` for redirect URIs.

### 1. Start ngrok

Start ngrok to expose your local server (running on port 3000):

```bash
ngrok http 3000
```

Copy the HTTPS URL generated by ngrok (e.g., `https://your-subdomain.ngrok-free.app`).

### 2. Update Environment Variables

In your `.env` file, update the `AUTH_TRUSTED_ORIGINS` variable to include your ngrok URL. This is required for the authentication system to accept requests from this origin.

```env
AUTH_TRUSTED_ORIGINS="http://localhost:3000,https://your-subdomain.ngrok-free.app"
```

### 3. Update TikTok Developer Console

1.  Go to the [TikTok Developer Portal](https://developers.tiktok.com/).
2.  Navigate to your app's settings.
3.  Under **Login Kit**, add your ngrok Redirect URI:
    *   Format: `https://your-subdomain.ngrok-free.app/admin/tiktok-accounts`
    *   **Note:** This must match *exactly* with the URL you visit in the browser.

### 4. Access the App

**Crucial Step:** Open your browser and visit the app using the **ngrok URL**, NOT `localhost`.

*   Go to: `https://your-subdomain.ngrok-free.app/admin/tiktok-accounts`

If you visit via `localhost`, the redirect URI sent to TikTok will be `localhost`, which will cause a mismatch error.
